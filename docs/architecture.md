# Pockode 技术架构

## 整体架构

前后端分离，后端调用 AI CLI 工具。

```
┌─────────────────────────────────────────────────────┐
│                   CloudFront                         │
│                (React SPA 静态托管)                   │
└─────────────────────┬───────────────────────────────┘
                      │ WebSocket
                      ▼
┌─────────────────────────────────────────────────────┐
│                  EC2 Docker                          │
│                   Go 服务                            │
└─────────────────────┬───────────────────────────────┘
                      │ spawn + stream-json
                      ▼
┌─────────────────────────────────────────────────────┐
│           AI CLI (claude / gemini / ...)            │
└─────────────────────────────────────────────────────┘
```

## 技术选型

| 层 | 选择 | 理由 |
|----|------|------|
| 前端 | React + Vite + Tailwind | CDN 部署，生态成熟，快速开发 |
| 后端 | Go | 单一二进制，轻量，适合小型实例 |
| 通信 | WebSocket | 流式输出 |
| AI 调用 | CLI 子进程 | 不绑定特定 SDK，支持多种 AI 代理 |

## AI 代理调用

通过 CLI 调用，解析 JSON 流输出：

```bash
claude -p "prompt" --output-format stream-json
```

定义统一的事件接口，各 CLI 适配器负责转换：

```
AgentEvent = text | tool_call | tool_result | error | done
```

## 部署

- **前端**: S3 + CloudFront
- **后端**: EC2 Docker（需包含 AI CLI）
